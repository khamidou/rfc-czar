<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title></title>
  <link rel="stylesheet" href="rfc.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1></h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-'>
      <td class=docs>
        <p class="rfcparagraph">Internet Engineering Task Force (IETF)                      G. Camarillo
Request for Comments: 6156                                       O. Novo
Category: Standards Track                                       Ericsson
ISSN: 2070-1721                                        S. Perreault, Ed.
                                                                Viagenie
                                                              April 2011


      Traversal Using Relays around NAT (TURN) Extension for IPv6

<h2>Abstract</h2>

   This document adds IPv6 support to Traversal Using Relays around NAT
   (TURN).  IPv6 support in TURN includes IPv4-to-IPv6, IPv6-to-IPv6,
   and IPv6-to-IPv4 relaying.  This document defines the REQUESTED-
   ADDRESS-FAMILY attribute for TURN.  The REQUESTED-ADDRESS-FAMILY
   attribute allows a client to explicitly request the address type the
   TURN server will allocate (e.g., an IPv4-only node may request the
   TURN server to allocate an IPv6 address).

</p><p class="rfcparagraph">Status of This Memo

   This is an Internet Standards Track document.

</p><p class="rfcparagraph">   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in Section 2 of RFC 5741.

</p><p class="rfcparagraph">   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   http://www.rfc-editor.org/info/rfc6156.

</p><p class="rfcparagraph"><h2>Copyright Notice</h2>

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

</p><p class="rfcparagraph">   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.
<h2>Table of Contents</h2>
<a href="#section-1" class="">1. Introduction . . . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-2" class="">2. Terminology  . . . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-3" class="">3. Overview of Operation  . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-4" class="">4. Creating an Allocation . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-4.1" class="indent-1">4.1. Sending an Allocate Request  . . . . . . . . . . . . . . </a><br>
<a href="#section-4.1.1" class="indent-2">4.1.1. The REQUESTED-ADDRESS-FAMILY Attribute . . . . . . . </a><br>
<a href="#section-4.2" class="indent-1">4.2. Receiving an Allocate Request  . . . . . . . . . . . . . </a><br>
<a href="#section-4.2.1" class="indent-2">4.2.1. Unsupported Address Family . . . . . . . . . . . . . </a><br>
<a href="#section-4.3" class="indent-1">4.3. Receiving an Allocate Error Response . . . . . . . . . . </a><br>
<a href="#section-5" class="">5. Refreshing an Allocation . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-5.1" class="indent-1">5.1. Sending a Refresh Request  . . . . . . . . . . . . . . . </a><br>
<a href="#section-5.2" class="indent-1">5.2. Receiving a Refresh Request  . . . . . . . . . . . . . . </a><br>
<a href="#section-6" class="">6. CreatePermission . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-6.1" class="indent-1">6.1. Sending a CreatePermission Request . . . . . . . . . . . </a><br>
<a href="#section-6.2" class="indent-1">6.2. Receiving a CreatePermission Request . . . . . . . . . . </a><br>
<a href="#section-6.2.1" class="indent-2">6.2.1. Peer Address Family Mismatch . . . . . . . . . . . . </a><br>
<a href="#section-7" class="">7. Channels . . . . . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-7.1" class="indent-1">7.1. Sending a ChannelBind Request  . . . . . . . . . . . . . </a><br>
<a href="#section-7.2" class="indent-1">7.2. Receiving a ChannelBind Request  . . . . . . . . . . . . </a><br>
<a href="#section-8" class="">8. Packet Translations  . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-8.1" class="indent-1">8.1. IPv4-to-IPv6 Translations  . . . . . . . . . . . . . . . </a><br>
<a href="#section-8.2" class="indent-1">8.2. IPv6-to-IPv6 Translations  . . . . . . . . . . . . . . . </a><br>
<a href="#section-8.3" class="indent-1">8.3. IPv6-to-IPv4 Translations  . . . . . . . . . . . . . . . </a><br>
<a href="#section-9" class="">9. Security Considerations  . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-9.1" class="indent-1">9.1. Tunnel Amplification Attack  . . . . . . . . . . . . . . </a><br>
<a href="#section-10" class="">10. IANA Considerations  . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-10.1" class="indent-1">10.1. New STUN Attribute . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-10.2" class="indent-1">10.2. New STUN Error Codes . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-11" class="">11. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-12" class="">12. References . . . . . . . . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-12.1" class="indent-1">12.1. Normative References . . . . . . . . . . . . . . . . . . </a><br>
<a href="#section-12.2" class="indent-1">12.2. Informative References . . . . . . . . . . . . . . . . . </a><br>
	<a name="section-1"><h2>1.   Introduction</h2></a>

   Traversal Using Relays around NAT (TURN) [RFC5766] is a protocol that
   allows for an element behind a NAT to receive incoming data over UDP
   or TCP.  It is most useful for elements behind NATs without Endpoint-
   Independent Mapping [RFC4787] that wish to be on the receiving end of
   a connection to a single peer.

</p><p class="rfcparagraph">   The base specification of TURN [RFC5766] only defines IPv4-to-IPv4
   relaying.  This document adds IPv6 support to TURN, which includes
   IPv4-to-IPv6, IPv6-to-IPv6, and IPv6-to-IPv4 relaying.  This document
   defines the REQUESTED-ADDRESS-FAMILY attribute, which is an extension
   to TURN that allows a client to explicitly request the address type
   the TURN server will allocate (e.g., an IPv4-only node may request
   the TURN server to allocate an IPv6 address).  This document also
   defines and registers new error response codes.

</p><p class="rfcparagraph">	<a name="section-2"><h2>2.   Terminology</h2></a>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

</p><p class="rfcparagraph">	<a name="section-3"><h2>3.   Overview of Operation</h2></a>

   When a user wishes a TURN server to allocate an address of a specific
   type, it sends an Allocate request to the TURN server with a
   REQUESTED-ADDRESS-FAMILY attribute.  TURN can run over UDP and TCP,
   and it allows for a client to request address/port pairs for
   receiving both UDP and TCP.

</p><p class="rfcparagraph">   After the request has been successfully authenticated, the TURN
   server allocates a transport address of the type indicated in the
   REQUESTED-ADDRESS-FAMILY attribute.  This address is called the
   relayed transport address.

</p><p class="rfcparagraph">   The TURN server returns the relayed transport address in the response
   to the Allocate request.  This response contains an XOR-RELAYED-
   ADDRESS attribute indicating the IP address and port that the server
   allocated for the client.

</p><p class="rfcparagraph">   TURN servers allocate a single relayed transport address per
   allocation request.  Therefore, Allocate requests cannot carry more
   than one REQUESTED-ADDRESS-FAMILY attribute.  Consequently, a client
   that wishes to allocate more than one relayed transport address at a
   TURN server (e.g., an IPv4 and an IPv6 address) needs to perform
   several allocation requests (one allocation request per relayed
   transport address).
   A TURN server that supports a set of address families is assumed to
   be able to relay packets between them.  If a server does not support
   the address family requested by a client, the server returns a 440
   (Address Family not Supported) error response.

</p><p class="rfcparagraph">	<a name="section-4"><h2>4.   Creating an Allocation</h2></a>

   The behavior specified here affects the processing defined in Section
   6 of [RFC5766].

</p><p class="rfcparagraph">	<a name="section-4.1"><h3>4.1   Sending an Allocate Request</h3></a>

   A client that wishes to obtain a relayed transport address of a
   specific address type includes a REQUESTED-ADDRESS-FAMILY attribute,
   which is defined in Section 4.1.1, in the Allocate request that it
   sends to the TURN server.  Clients MUST NOT include more than one
   REQUESTED-ADDRESS-FAMILY attribute in an Allocate request.  The
   mechanisms to formulate an Allocate request are described in Section
   6.1 of [RFC5766].

</p><p class="rfcparagraph">   Clients MUST NOT include a REQUESTED-ADDRESS-FAMILY attribute in an
   Allocate request that contains a RESERVATION-TOKEN attribute.

</p><p class="rfcparagraph">	<a name="section-4.1.1"><h4>4.1.1   The REQUESTED-ADDRESS-FAMILY Attribute</h4></a>

   The REQUESTED-ADDRESS-FAMILY attribute is used by clients to request
   the allocation of a specific address type from a server.  The
   following is the format of the REQUESTED-ADDRESS-FAMILY attribute.
   Note that TURN attributes are TLV (Type-Length-Value) encoded, with a
   16-bit type, a 16-bit length, and a variable-length value.

</p><p class="rfcparagraph">    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Type                  |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Family    |            Reserved                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

          Figure 1: Format of REQUESTED-ADDRESS-FAMILY Attribute

   Type:  the type of the REQUESTED-ADDRESS-FAMILY attribute is 0x0017.
      As specified in [RFC5389], attributes with values between 0x0000
      and 0x7FFF are comprehension-required, which means that the client
      or server cannot successfully process the message unless it
      understands the attribute.
   Length:  this 16-bit field contains the length of the attribute in
      bytes.  The length of this attribute is 4 bytes.

</p><p class="rfcparagraph">   Family:  there are two values defined for this field and specified in
      [RFC5389], Section 15.1: 0x01 for IPv4 addresses and 0x02 for IPv6
      addresses.

</p><p class="rfcparagraph">   Reserved:  at this point, the 24 bits in the Reserved field MUST be
      set to zero by the client and MUST be ignored by the server.

</p><p class="rfcparagraph">   The REQUEST-ADDRESS-TYPE attribute MAY only be present in Allocate
   requests.

</p><p class="rfcparagraph">	<a name="section-4.2"><h3>4.2   Receiving an Allocate Request</h3></a>

   Once a server has verified that the request is authenticated and has
   not been tampered with, the TURN server processes the Allocate
   request.  If it contains both a RESERVATION-TOKEN and a REQUESTED-
   ADDRESS-FAMILY, the server replies with a 400 (Bad Request) Allocate
   error response.  Following the rules in [RFC5389], if the server does
   not understand the REQUESTED-ADDRESS-FAMILY attribute, it generates
   an Allocate error response, which includes an ERROR-CODE attribute
   with 420 (Unknown Attribute) response code.  This response will
   contain an UNKNOWN-ATTRIBUTE attribute listing the unknown REQUESTED-
   ADDRESS-FAMILY attribute.

</p><p class="rfcparagraph">   If the server can successfully process the request, it allocates a
   transport address for the TURN client, called the relayed transport
   address, and returns it in the response to the Allocate request.

</p><p class="rfcparagraph">   As specified in [RFC5766], the Allocate response contains the same
   transaction ID contained in the Allocate request, and the XOR-
   RELAYED-ADDRESS attribute is set to the relayed transport address.

</p><p class="rfcparagraph">   The XOR-RELAYED-ADDRESS attribute indicates the allocated IP address
   and port.  It is encoded in the same way as the XOR-MAPPED-ADDRESS
   [RFC5389].

</p><p class="rfcparagraph">   If the REQUESTED-ADDRESS-FAMILY attribute is absent, the server MUST
   allocate an IPv4-relayed transport address for the TURN client.  If
   allocation of IPv4 addresses is disabled by local policy, the server
   returns a 440 (Address Family not Supported) Allocate error response.

</p><p class="rfcparagraph">   If the server does not support the address family requested by the
   client, it MUST generate an Allocate error response, and it MUST
   include an ERROR-CODE attribute with the 440 (Address Family not
   Supported) response code, which is defined in Section 4.2.1.
	<a name="section-4.2.1"><h4>4.2.1   Unsupported Address Family</h4></a>

   This document defines the following new error response code:

</p><p class="rfcparagraph">   440 (Address Family not Supported):  The server does not support the
      address family requested by the client.

</p><p class="rfcparagraph">	<a name="section-4.3"><h3>4.3   Receiving an Allocate Error Response</h3></a>

   If the client receives an Allocate error response with the 440
   (Unsupported Address Family) error code, the client MUST NOT retry
   its request.

</p><p class="rfcparagraph">	<a name="section-5"><h2>5.   Refreshing an Allocation</h2></a>

   The behavior specified here affects the processing defined in Section
   7 of [RFC5766].

</p><p class="rfcparagraph">	<a name="section-5.1"><h3>5.1   Sending a Refresh Request</h3></a>

   To perform an allocation refresh, the client generates a Refresh
   Request as described in Section 7.1 of [RFC5766].  The client MUST
   NOT include any REQUESTED-ADDRESS-FAMILY attribute in its Refresh
   Request.

</p><p class="rfcparagraph">	<a name="section-5.2"><h3>5.2   Receiving a Refresh Request</h3></a>

   If a server receives a Refresh Request with a REQUESTED-ADDRESS-
   FAMILY attribute, and the attribute's value doesn't match the address
   family of the allocation, the server MUST reply with a 443 (Peer
   Address Family Mismatch) Refresh error response.

</p><p class="rfcparagraph">	<a name="section-6"><h2>6.   CreatePermission</h2></a>

   The behavior specified here affects the processing defined in Section
   9 of [RFC5766].

</p><p class="rfcparagraph">	<a name="section-6.1"><h3>6.1   Sending a CreatePermission Request</h3></a>

   The client MUST only include XOR-PEER-ADDRESS attributes with
   addresses of the same address family as that of the relayed transport
   address for the allocation.
	<a name="section-6.2"><h3>6.2   Receiving a CreatePermission Request</h3></a>

   If an XOR-PEER-ADDRESS attribute contains an address of an address
   family different than that of the relayed transport address for the
   allocation, the server MUST generate an error response with the 443
   (Peer Address Family Mismatch) response code, which is defined in
   Section 6.2.1.

</p><p class="rfcparagraph">	<a name="section-6.2.1"><h4>6.2.1   Peer Address Family Mismatch</h4></a>

   This document defines the following new error response code:

</p><p class="rfcparagraph">   443 (Peer Address Family Mismatch):  A peer address was of a
      different address family than that of the relayed transport
      address of the allocation.

</p><p class="rfcparagraph">	<a name="section-7"><h2>7.   Channels</h2></a>

   The behavior specified here affects the processing defined in Section
   11 of [RFC5766].

</p><p class="rfcparagraph">	<a name="section-7.1"><h3>7.1   Sending a ChannelBind Request</h3></a>

   The client MUST only include an XOR-PEER-ADDRESS attribute with an
   address of the same address family as that of the relayed transport
   address for the allocation.

</p><p class="rfcparagraph">	<a name="section-7.2"><h3>7.2   Receiving a ChannelBind Request</h3></a>

   If the XOR-PEER-ADDRESS attribute contains an address of an address
   family different than that of the relayed transport address for the
   allocation, the server MUST generate an error response with the 443
   (Peer Address Family Mismatch) response code, which is defined in
   Section 6.2.1.

</p><p class="rfcparagraph">	<a name="section-8"><h2>8.   Packet Translations</h2></a>

   The TURN specification [RFC5766] describes how TURN relays should
   relay traffic consisting of IPv4 packets (i.e., IPv4-to-IPv4
   translations).  The relay translates the IP addresses and port
   numbers of the packets based on the allocation's state data.  How to
   translate other header fields is also specified in [RFC5766].  This
   document addresses IPv4-to-IPv6, IPv6-to-IPv4, and IPv6-to-IPv6
   translations.
   TURN relays performing any translation MUST translate the IP
   addresses and port numbers of the packets based on the allocation's
   state information as specified in [RFC5766].  The following sections
   specify how to translate other header fields.

</p><p class="rfcparagraph">   As discussed in Section 2.6 of [RFC5766], translations in TURN are
   designed so that a TURN server can be implemented as an application
   that runs in "user-land" under commonly available operating systems
   and that does not require special privileges.  The translations
   specified in the following sections follow this principle.

</p><p class="rfcparagraph">   The descriptions below have two parts: a preferred behavior and an
   alternate behavior.  The server SHOULD implement the preferred
   behavior.  Otherwise, the server MUST implement the alternate
   behavior and MUST NOT do anything else.

</p><p class="rfcparagraph">	<a name="section-8.1"><h3>8.1   IPv4-to-IPv6 Translations</h3></a>

   Traffic Class

      Preferred behavior: as specified in Section 4 of [RFC6145].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Traffic Class to the
      default value for outgoing packets.

</p><p class="rfcparagraph">   Flow Label

      Preferred behavior: the relay sets the Flow label to 0.  The relay
      can choose to set the Flow label to a different value if it
      supports the IPv6 Flow Label field [RFC3697].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Flow label to the default
      value for outgoing packets.

</p><p class="rfcparagraph">   Hop Limit

      Preferred behavior: as specified in Section 4 of [RFC6145].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Hop Limit to the default
      value for outgoing packets.

</p><p class="rfcparagraph">   Fragmentation

      Preferred behavior: as specified in Section 4 of [RFC6145].

</p><p class="rfcparagraph">      Alternate behavior: the relay assembles incoming fragments.  The
      relay follows its default behavior to send outgoing packets.
      For both preferred and alternate behavior, the DONT-FRAGMENT
      attribute ([RFC5766], Section 14.8) MUST be ignored by the server.

</p><p class="rfcparagraph">   Extension Headers

      Preferred behavior: the relay sends the outgoing packet without
      any IPv6 extension headers, with the exception of the Fragment
      Header as described above.

</p><p class="rfcparagraph">      Alternate behavior: same as preferred.

</p><p class="rfcparagraph">	<a name="section-8.2"><h3>8.2   IPv6-to-IPv6 Translations</h3></a>

   Flow Label

      The relay should consider that it is handling two different IPv6
      flows.  Therefore, the Flow label [RFC3697] SHOULD NOT be copied
      as part of the translation.

</p><p class="rfcparagraph">      Preferred behavior: the relay sets the Flow label to 0.  The relay
      can choose to set the Flow label to a different value if it
      supports the IPv6 Flow Label field [RFC3697].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Flow label to the default
      value for outgoing packets.

</p><p class="rfcparagraph">   Hop Limit

      Preferred behavior: the relay acts as a regular router with
      respect to decrementing the Hop Limit and generating an ICMPv6
      error if it reaches zero.

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Hop Limit to the default
      value for outgoing packets.

</p><p class="rfcparagraph">   Fragmentation

      Preferred behavior: if the incoming packet did not include a
      Fragment Header and the outgoing packet size does not exceed the
      outgoing link's MTU, the relay sends the outgoing packet without a
      Fragment Header.

</p><p class="rfcparagraph">      If the incoming packet did not include a Fragment Header and the
      outgoing packet size exceeds the outgoing link's MTU, the relay
      drops the outgoing packet and sends an ICMP message of Type 2,
      Code 0 ("Packet too big") to the sender of the incoming packet.
      If the packet is being sent to the peer, the relay reduces the MTU
      reported in the ICMP message by 48 bytes to allow room for the
      overhead of a Data indication.

</p><p class="rfcparagraph">      If the incoming packet included a Fragment Header and the outgoing
      packet size (with a Fragment Header included) does not exceed the
      outgoing link's MTU, the relay sends the outgoing packet with a
      Fragment Header.  The relay sets the fields of the Fragment Header
      as appropriate for a packet originating from the server.

</p><p class="rfcparagraph">      If the incoming packet included a Fragment Header and the outgoing
      packet size exceeds the outgoing link's MTU, the relay MUST
      fragment the outgoing packet into fragments of no more than 1280
      bytes.  The relay sets the fields of the Fragment Header as
      appropriate for a packet originating from the server.

</p><p class="rfcparagraph">      Alternate behavior: the relay assembles incoming fragments.  The
      relay follows its default behavior to send outgoing packets.

</p><p class="rfcparagraph">      For both preferred and alternate behavior, the DONT-FRAGMENT
      attribute MUST be ignored by the server.

</p><p class="rfcparagraph">   Extension Headers

      Preferred behavior: the relay sends the outgoing packet without
      any IPv6 extension headers, with the exception of the Fragment
      Header as described above.

</p><p class="rfcparagraph">      Alternate behavior: same as preferred.

</p><p class="rfcparagraph">	<a name="section-8.3"><h3>8.3   IPv6-to-IPv4 Translations</h3></a>

   Type of Service and Precedence

      Preferred behavior: as specified in Section 5 of [RFC6145].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Type of Service and
      Precedence to the default value for outgoing packets.

</p><p class="rfcparagraph">   Time to Live

      Preferred behavior: as specified in Section 5 of [RFC6145].

</p><p class="rfcparagraph">      Alternate behavior: the relay sets the Time to Live to the default
      value for outgoing packets.
   Fragmentation

      Preferred behavior: as specified in Section 5 of [RFC6145].
      Additionally, when the outgoing packet's size exceeds the outgoing
      link's MTU, the relay needs to generate an ICMP error (ICMPv6
      Packet Too Big) reporting the MTU size.  If the packet is being
      sent to the peer, the relay SHOULD reduce the MTU reported in the
      ICMP message by 48 bytes to allow room for the overhead of a Data
      indication.

</p><p class="rfcparagraph">      Alternate behavior: the relay assembles incoming fragments.  The
      relay follows its default behavior to send outgoing packets.

</p><p class="rfcparagraph">      For both preferred and alternate behavior, the DONT-FRAGMENT
      attribute MUST be ignored by the server.

</p><p class="rfcparagraph">	<a name="section-9"><h2>9.   Security Considerations</h2></a>

   Translation between IPv4 and IPv6 creates a new way for clients to
   obtain IPv4 or IPv6 access that they did not have before.  For
   example, an IPv4-only client having access to a TURN server
   implementing this specification is now able to access the IPv6
   Internet.  This needs to be considered when establishing security and
   monitoring policies.

</p><p class="rfcparagraph">   The loop attack described in [RFC5766], Section 17.1.7, may be more
   easily done in cases where address spoofing is easier to accomplish
   over IPv6.  Mitigation of this attack over IPv6 is the same as for
   IPv4.

</p><p class="rfcparagraph">   All the security considerations applicable to STUN [RFC5389] and TURN
   [RFC5766] are applicable to this document as well.

</p><p class="rfcparagraph">	<a name="section-9.1"><h3>9.1   Tunnel Amplification Attack</h3></a>

   An attacker might attempt to cause data packets to loop numerous
   times between a TURN server and a tunnel between IPv4 and IPv6.  The
   attack goes as follows.

</p><p class="rfcparagraph">   Suppose an attacker knows that a tunnel endpoint will forward
   encapsulated packets from a given IPv6 address (this doesn't
   necessarily need to be the tunnel endpoint's address).  Suppose he
   then spoofs these two packets from this address:

</p><p class="rfcparagraph">   1.  An Allocate request asking for a v4 address, and

   2.  A ChannelBind request establishing a channel to the IPv4 address
       of the tunnel endpoint
   Then he has set up an amplification attack:

</p><p class="rfcparagraph">   o  The TURN relay will re-encapsulate IPv6 UDP data in v4 and send it
      to the tunnel endpoint.

</p><p class="rfcparagraph">   o  The tunnel endpoint will decapsulate packets from the v4 interface
      and send them to v6.

</p><p class="rfcparagraph">   So, if the attacker sends a packet of the following form:

</p><p class="rfcparagraph">     IPv6: src=2001:db9::1 dst=2001:db8::2
     UDP:  <ports>
     TURN: <channel id>
     IPv6: src=2001:db9::1 dst=2001:db8::2
     UDP:  <ports>
     TURN: <channel id>
     IPv6: src=2001:db9::1 dst=2001:db8::2
     UDP:  <ports>
     TURN: <channel id>
     ...

</p><p class="rfcparagraph">   Then the TURN relay and the tunnel endpoint will send it back and
   forth until the last TURN header is consumed, at which point the TURN
   relay will send an empty packet that the tunnel endpoint will drop.

</p><p class="rfcparagraph">   The amplification potential here is limited by the MTU, so it's not
   huge: IPv6+UDP+TURN takes 334 bytes, so you could get a four-to-one
   amplification out of a 1500-byte packet.  But the attacker could
   still increase traffic volume by sending multiple packets or by
   establishing multiple channels spoofed from different addresses
   behind the same tunnel endpoint.

</p><p class="rfcparagraph">   The attack is mitigated as follows.  It is RECOMMENDED that TURN
   relays not accept allocation or channel binding requests from
   addresses known to be tunneled, and that they not forward data to
   such addresses.  In particular, a TURN relay MUST NOT accept Teredo
   or 6to4 addresses in these requests.

</p><p class="rfcparagraph">	<a name="section-10"><h2>10.   IANA Considerations</h2></a>

   IANA registered the following values under the "STUN Attributes"
   registry and under the "STUN Error Codes" registry.

</p><p class="rfcparagraph">	<a name="section-10.1"><h3>10.1   New STUN Attribute</h3></a>

     0x0017: REQUESTED-ADDRESS-FAMILY
	<a name="section-10.2"><h3>10.2   New STUN Error Codes</h3></a>

     440  Address Family not Supported
     443  Peer Address Family Mismatch

	<a name="section-11"><h2>11.   Acknowledgements</h2></a>

   The authors would like to thank Alfred E. Heggestad, Dan Wing, Magnus
   Westerlund, Marc Petit-Huguenin, Philip Matthews, and Remi Denis-
   Courmont for their feedback on this document.

</p><p class="rfcparagraph">	<a name="section-12"><h2>12.   References</h2></a>

	<a name="section-12.1"><h3>12.1   Normative References</h3></a>

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

</p><p class="rfcparagraph">   [RFC3697]  Rajahalme, J., Conta, A., Carpenter, B., and S. Deering,
              "IPv6 Flow Label Specification", RFC 3697, March 2004.

</p><p class="rfcparagraph">   [RFC5389]  Rosenberg, J., Mahy, R., Matthews, P., and D. Wing,
              "Session Traversal Utilities for NAT (STUN)", RFC 5389,
              October 2008.

</p><p class="rfcparagraph">   [RFC5766]  Mahy, R., Matthews, P., and J. Rosenberg, "Traversal Using
              Relays around NAT (TURN): Relay Extensions to Session
              Traversal Utilities for NAT (STUN)", RFC 5766, April 2010.

</p><p class="rfcparagraph">   [RFC6145]  Li, X., Bao, C., and F. Baker, "IP/ICMP Translation
              Algorithm", RFC 6145, April 2011.

</p>	<a name="section-12.2"><h3>12.2   Informative References</h3></a>

   [RFC4787]  Audet, F. and C. Jennings, "Network Address Translation
              (NAT) Behavioral Requirements for Unicast UDP", BCP 127,
              RFC 4787, January 2007.
Authors' Addresses

   Gonzalo Camarillo
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   EMail: Gonzalo.Camarillo@ericsson.com


   Oscar Novo
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   EMail: Oscar.Novo@ericsson.com


   Simon Perreault (editor)
   Viagenie
   2600 boul. Laurier, suite D2-630
   Quebec, QC  G1V 2M2
   Canada

   Phone: +1 418 656 9254
   EMail: simon.perreault@viagenie.ca
   URI:   http://www.viagenie.ca






















Camarillo, et al.            Standards Track                   [Page 14]


      </td>
      <td class=code>
        <div class='highlight'>
            <!--
            <b>Related Stack Overflow questions:</b>
            <ul>
                
            </ul>
            -->
        </div>
      </td>
    </tr>
  </table>
</div>
</body>